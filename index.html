<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catalog & Orders App</title>
<style>
body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f0f0f0; }
.header { background:#ff6b6b; color:white; padding:15px; text-align:center; }
.navbar { display:flex; justify-content:center; gap:10px; margin-bottom:10px; }
.navbar button { padding:10px 15px; border:none; border-radius:5px; cursor:pointer; background:#3498db; color:white; }
.navbar button.active { background:#2ecc71; }
.search-bar { width:90%; padding:10px; border-radius:25px; border:none; margin:10px auto; display:block; }
.products-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(250px,1fr)); gap:15px; padding:20px; }
.product-card { background:white; padding:15px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1); }
.product-image { text-align:center; margin-bottom:10px; }
.product-image img { max-width:100%; border-radius:10px; }
.product-name { font-weight:bold; font-size:16px; margin-bottom:5px; }
.product-description { font-size:14px; margin-bottom:5px; }
.product-weight { font-size:14px; color:#555; margin-bottom:5px; }
.product-price { font-weight:bold; color:#27ae60; margin-bottom:5px; }
.product-rating { color:#f39c12; margin-bottom:5px; }
.add-to-cart { background:#3498db; color:white; border:none; padding:8px; border-radius:5px; cursor:pointer; }
.cart-page, .orders-page { display:none; padding:20px; }
.cart-item, .order-card { background:white; padding:10px; margin-bottom:10px; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
.cart-item-name, .order-title { font-weight:bold; }
.cart-buttons { display:flex; gap:10px; margin-top:10px; }
.cart-buttons button { padding:10px; border:none; border-radius:8px; cursor:pointer; flex:1; }
</style>
</head>
<body>

<div class="header">
  <h1>üõçÔ∏è Catalog & Orders App</h1>
</div>

<div class="navbar">
  <button id="tabCatalog" class="active">Catalog</button>
  <button id="tabCart">Cart</button>
  <button id="tabOrders">Confirmed Orders</button>
</div>

<!-- Catalog Page -->
<div id="catalogPage">
  <input type="text" id="searchInput" class="search-bar" placeholder="Search products...">
  <div class="products-grid" id="productsGrid">Loading products...</div>
</div>

<!-- Cart Page -->
<div id="cartPage" class="cart-page">
  <h2>üõí Your Cart</h2>
  <div id="cartItems"></div>
  <div><strong>Total: $<span id="cartTotal">0.00</span></strong></div>
  <div class="cart-buttons">
    <button id="continueShoppingBtn" style="background:#95a5a6;color:white;">Continue Shopping</button>
    <button id="confirmOrderBtn" style="background:#27ae60;color:white;">Confirm Order</button>
  </div>
</div>

<!-- Orders Page -->
<div id="ordersPage" class="orders-page">
  <h2>üì¶ Confirmed Orders</h2>
  <div id="ordersContainer">Loading orders...</div>
</div>

<script>
// =================== CONFIG ===================
const PRODUCTS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwqdkURKVdzcMuRAGPWTi0iMWIWh6clarKE3tqv71A15KP4Db4uovz8CikoWlukG1EZBw/exec';
const ORDERS_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycby2TJlf4Tm8oreTqZSiQKCtYdaGCO4O2gruz_vCnXgS8eu5u3LOg6XL_9eshn8GEA/exec';

// =================== STATE ===================
let products = [];
let cart = [];
let searchTerm = '';

// =================== NAVIGATION ===================
const catalogPage = document.getElementById('catalogPage');
const cartPage = document.getElementById('cartPage');
const ordersPage = document.getElementById('ordersPage');

document.getElementById('tabCatalog').addEventListener('click', () => showPage('catalog'));
document.getElementById('tabCart').addEventListener('click', () => showPage('cart'));
document.getElementById('tabOrders').addEventListener('click', () => showPage('orders'));

function showPage(page) {
  catalogPage.style.display = page==='catalog' ? 'block' : 'none';
  cartPage.style.display = page==='cart' ? 'block' : 'none';
  ordersPage.style.display = page==='orders' ? 'block' : 'none';
  document.querySelectorAll('.navbar button').forEach(b => b.classList.remove('active'));
  document.getElementById('tabCatalog').classList.toggle('active', page==='catalog');
  document.getElementById('tabCart').classList.toggle('active', page==='cart');
  document.getElementById('tabOrders').classList.toggle('active', page==='orders');
  if(page==='orders') fetchOrders();
}

// =================== FETCH PRODUCTS ===================
fetch(PRODUCTS_WEB_APP_URL)
  .then(res => res.json())
  .then(data => { products = data; renderProducts(); })
  .catch(err => document.getElementById('productsGrid').innerHTML='Failed to load products');

// =================== SEARCH ===================
document.getElementById('searchInput').addEventListener('input', e => {
  searchTerm = e.target.value.toLowerCase();
  renderProducts();
});

// =================== RENDER PRODUCTS ===================
function renderProducts() {
  const grid = document.getElementById('productsGrid');
  let filtered = products.filter(p => 
    p.Name.toLowerCase().includes(searchTerm) || 
    p.Description.toLowerCase().includes(searchTerm)
  );
  if(filtered.length===0){ grid.innerHTML='No products found'; return; }

  grid.innerHTML = filtered.map(p=>`
    <div class="product-card">
      <div class="product-image"><img src="${p.Image}" alt="${p.Name}"></div>
      <div class="product-name">${p.Name}</div>
      <div class="product-description">${p.Description}</div>
      <div class="product-weight">Weight: ${p.Weight}</div>
      <div class="product-price">$${p.Price}</div>
      <div class="product-rating">Rating: ${p.Rating} ‚≠ê</div>
      <div>
        Qty: <input type="number" id="qty-${p.ID}" value="1" min="1" style="width:50px;">
        <button class="add-to-cart" onclick="addToCart(${p.ID})">Add</button>
      </div>
    </div>
  `).join('');
}

// =================== CART ===================
function addToCart(id){
  const product = products.find(p=>p.ID==id);
  const qty = parseInt(document.getElementById(`qty-${id}`).value);
  if(!qty || qty<1) return;
  const existing = cart.find(item=>item.ID==id);
  if(existing) existing.qty += qty;
  else cart.push({...product, qty});
  showPage('cart'); renderCart();
}

function renderCart(){
  const container = document.getElementById('cartItems');
  container.innerHTML = '';
  let total = 0;
  cart.forEach(item=>{
    total += parseFloat(item.Price)*item.qty;
    container.innerHTML += `
      <div class="cart-item">
        <div class="cart-item-name">${item.Name}</div>
        <div>Qty: ${item.qty}</div>
        <div>Price: $${item.Price}</div>
      </div>
    `;
  });
  document.getElementById('cartTotal').innerText = total.toFixed(2);
}

// =================== CART BUTTONS ===================
document.getElementById('continueShoppingBtn').addEventListener('click', ()=> showPage('catalog'));

document.getElementById('confirmOrderBtn').addEventListener('click', ()=>{
  if(cart.length===0){ alert('Cart is empty'); return; }

  const customerName = prompt('Enter your name');
  const customerSurname = prompt('Enter your surname');
  const customerPhone = prompt('Enter phone number');
  const customerAddress = prompt('Enter delivery address');

  // VALIDATION: required fields
  if(!customerName || !customerSurname || !customerPhone || !customerAddress){
    alert('‚ùå All fields are required. Order not confirmed.');
    return;
  }

  // VALIDATION: phone 10 digits
  if(!/^\d{10}$/.test(customerPhone)){
    alert('‚ùå Phone number must be exactly 10 digits.');
    return;
  }

  const productsStr = cart.map(i=>`${i.Name} x ${i.qty} = $${i.Price}`).join('; ');
  const total = cart.reduce((sum,i)=>sum + parseFloat(i.Price)*i.qty,0).toFixed(2);

  const orderData = { customerName, customerSurname, customerPhone, customerAddress, products: productsStr, total };

  fetch(ORDERS_WEB_APP_URL, {
    method:'POST',
    body: JSON.stringify(orderData)
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.status==='success'){
      alert('‚úÖ Order confirmed!');
      cart=[]; renderCart(); showPage('catalog'); fetchOrders();
    } else {
      alert('Failed to send order');
    }
  })
  .catch(err=>{
    console.error(err);
    alert('Failed to send order. Check internet.');
  });
});

// =================== FETCH ORDERS ===================
function fetchOrders(){
  const container = document.getElementById('ordersContainer');
  container.innerHTML = 'Loading orders...';
  fetch(ORDERS_WEB_APP_URL)
    .then(res => res.json())
    .then(data => {
      if(!data || data.length===0){ container.innerHTML='No confirmed orders yet.'; return; }
      container.innerHTML = data.map(order => `
        <div class="order-card">
          <div class="order-title">Customer: ${order['Customer Name'] || 'N/A'} ${order['Surname'] || ''}</div>
          <div class="order-details">Phone: ${order['Phone'] || 'N/A'}</div>
          <div class="order-details">Address: ${order['Address'] || 'N/A'}</div>
          <div class="order-details">Products: ${order['Products'] || 'N/A'}</div>
          <div class="order-details">Total: $${order['Total'] || '0.00'}</div>
          <div class="order-details">Time: ${order['Timestamp'] || ''}</div>
        </div>
      `).join('');
    })
    .catch(err => { console.error(err); container.innerHTML='Failed to load orders.'; });
}
</script>

</body>
</html>
