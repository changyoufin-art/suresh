<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Catalog App</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    .product { border: 1px solid #ddd; padding: 10px; margin: 10px; border-radius: 8px; }
    .cart-icon { position: fixed; top: 10px; right: 10px; cursor: pointer; font-size: 18px; background: #28a745; color: white; padding: 6px 12px; border-radius: 8px; }
  </style>
</head>
<body>

  <h2>Product Catalog</h2>
  <div id="products"></div>

  <div class="cart-icon" onclick="showCart()">ðŸ›’ Cart (<span id="cartCount">0</span>)</div>

  <div id="cartPage" style="display:none;">
    <h2>Your Cart</h2>
    <div id="cartItems"></div>
    <p><b>Total: Rs.<span id="totalAmount">0</span></b></p>
    <h3>Customer Details</h3>
    <input id="custName" placeholder="Name"><br><br>
    <input id="custPhone" placeholder="Phone"><br><br>
    <textarea id="custAddress" placeholder="Address"></textarea><br><br>
    <button onclick="confirmOrder()">Confirm Order</button>
    <button onclick="hideCart()">Continue Shopping</button>
  </div>

  <script>
    const SCRIPT_URL = "YOUR_SCRIPT_URL";
    let cart = [];

    // Load Products
    fetch(`${SCRIPT_URL}?action=getProducts`)
      .then(res => res.json())
      .then(data => {
        const container = document.getElementById("products");
        data.forEach(p => {
          const div = document.createElement("div");
          div.className = "product";
          div.innerHTML = `
            <img src="${p.image}" width="100"><br>
            <b>${p.name}</b><br>
            ${p.description} (${p.weight})<br>
            Rs.${p.price}<br>
            Qty: <input type="number" id="qty-${p.id}" value="1" min="1" style="width:50px"><br><br>
            <button onclick="addToCart('${p.id}', '${p.name}', ${p.price})">Add to Cart</button>
          `;
          container.appendChild(div);
        });
      })
      .catch(err => {
        alert("Failed to load products: " + err);
      });

    function addToCart(id, name, price) {
      const qty = parseInt(document.getElementById("qty-" + id).value);
      cart.push({ id, name, price, qty });
      document.getElementById("cartCount").innerText = cart.length;
      alert(`${name} added to cart!`);
    }

    function showCart() {
      document.getElementById("products").style.display = "none";
      document.getElementById("cartPage").style.display = "block";
      renderCart();
    }

    function hideCart() {
      document.getElementById("products").style.display = "block";
      document.getElementById("cartPage").style.display = "none";
    }

    function renderCart() {
      const cartItems = document.getElementById("cartItems");
      cartItems.innerHTML = "";
      let total = 0;
      cart.forEach(c => {
        total += c.price * c.qty;
        cartItems.innerHTML += `<p>${c.name} x ${c.qty} = Rs.${c.price * c.qty}</p>`;
      });
      document.getElementById("totalAmount").innerText = total;
    }

    function confirmOrder() {
      const customerName = document.getElementById("custName").value;
      const customerPhone = document.getElementById("custPhone").value;
      const customerAddress = document.getElementById("custAddress").value;
      const products = JSON.stringify(cart);
      const total = document.getElementById("totalAmount").innerText;

      fetch(`${SCRIPT_URL}?action=submitOrder&customerName=${encodeURIComponent(customerName)}&customerPhone=${encodeURIComponent(customerPhone)}&customerAddress=${encodeURIComponent(customerAddress)}&products=${encodeURIComponent(products)}&total=${encodeURIComponent(total)}`)
        .then(res => res.json())
        .then(data => {
          if (data.status === "success") {
            alert("âœ… " + data.message);
            cart = [];
            document.getElementById("cartCount").innerText = 0;
            hideCart();
          } else {
            alert("âŒ Order failed: " + data.message);
          }
        })
        .catch(err => alert("Error: " + err));
    }
  </script>
</body>
</html>
